from openpyxl import load_workbook

# Ruta de tu archivo Excel
ruta_excel = r"C:\Users\CamiloAmaya\Documents\Prueba_excel\Libro1.xlsx"

def coincidir_ot():
    print("=== INICIANDO PROCESO DE COINCIDENCIA DE OTs ===")

    try:
        # Cargar el archivo Excel
        wb = load_workbook(ruta_excel)
        hoja_ot = wb["OTs"]        # Hoja donde est√°n los n√∫meros OT
        hoja_base = wb["Hoja2"]   # Hoja con los datos completos

        # --- Crear un diccionario con los datos de la hoja base ---
        print("üìã Leyendo datos de Hoja2...")
        datos_base = {}
        for fila in range(2, hoja_base.max_row + 1):
            clave = hoja_base[f"A{fila}"].value
            if clave:
                # Guardar todas las columnas desde B hasta H (puedes ajustar el rango)
                valores = [hoja_base.cell(row=fila, column=col).value for col in range(2, hoja_base.max_column + 1)]
                datos_base[str(clave)] = valores

        print(f"‚úÖ Datos cargados: {len(datos_base)} registros encontrados en Hoja2.")

        # --- Recorrer Hoja OT y copiar datos donde haya coincidencia ---
        print("üîç Buscando coincidencias y copiando datos...")
        coincidencias = 0
        for fila in range(2, hoja_ot.max_row + 1):
            clave_ot = hoja_ot[f"A{fila}"].value
            if clave_ot and str(clave_ot) in datos_base:
                valores = datos_base[str(clave_ot)]
                for j, valor in enumerate(valores, start=2):  # empieza en columna B
                    hoja_ot.cell(row=fila, column=j, value=valor)
                coincidencias += 1

        # --- Guardar cambios ---
        wb.save(ruta_excel)
        print(f"\n‚úÖ Coincidencias encontradas: {coincidencias}")
        print(f"üìò Archivo actualizado correctamente: {ruta_excel}")

    except Exception as e:
        print(f"‚ùå Error durante el proceso: {e}")

if __name__ == "__main__":
    coincidir_ot()
